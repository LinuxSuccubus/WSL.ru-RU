---
title: Взаимодействие Windows с Linux
description: Описывается взаимодействие Windows с дистрибутивами Linux, работающими в подсистеме Windows для Linux.
ms.date: 05/12/2020
ms.topic: article
ms.localizationpriority: high
ms.openlocfilehash: 2a9b6c8ac65fe28e029ada7f86475c44220a93fe
ms.sourcegitcommit: cb8a61e7de08b1c18622fc78bc5dfa38786e921a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/10/2020
ms.locfileid: "84663137"
---
# <a name="windows-interoperability-with-linux"></a>Взаимодействие Windows с Linux

В подсистеме Windows для Linux (WSL) постоянно улучшается интеграция между Windows и Linux.  Можно сделать следующее.

* Запустить средства Windows (например, notepad.exe) из командной строки Linux (например, Ubuntu).
* Запустить средства Linux (например, grep) из командной строки Windows (например, PowerShell).
* Совместное использование переменных среды между Linux и Windows. (сборка 17063+)

> [!NOTE]
> Если вы используете Creators Update (октябрь 2017 г., сборка 16299) или Юбилейное обновление (август 2016 г., сборка 14393), перейдите к [более ранним версиям Windows 10](#earlier-versions-of-windows-10).

## <a name="run-linux-tools-from-a-windows-command-line"></a>Запуск инструментов Linux из командной строки Windows

Запускайте двоичные файлы Linux из командной строки Windows (CMD или PowerShell), используя `wsl <command>` (или `wsl.exe <command>`).

Например:

```powershell
C:\temp> wsl ls -la
<- contents of C:\temp ->
```

Двоичные файлы вызываются следующим образом.

* Используется тот же рабочий каталог, что и для текущей командной строки или сеанса PowerShell.
* Файл выполняется от имени пользователя WSL по умолчанию.
* Требуются те же права администратора Windows, что и у вызывающего процесса и терминала.

Команда Linux после `wsl` (или `wsl.exe`) обрабатывается как любая команда, выполняемая в WSL.  Можно выполнять sudo, конвейерную передачу и перенаправление файлов.

Пример использования sudo для обновления дистрибутива Linux по умолчанию:

```powershell
C:\temp> wsl sudo apt-get update
```

Имя пользователя дистрибутива Linux по умолчанию будет указано после выполнения этой команды, и вам будет предложено указать пароль. После правильного ввода пароля дистрибутив скачает обновления.

## <a name="mixing-linux-and-windows-commands"></a>Смешивание команд Linux и Windows

Ниже приведено несколько примеров смешиваний команд Linux и Windows с помощью PowerShell.

Чтобы выполнить команду Linux `ls -la` для вывода списка файлов и команду PowerShell `findstr` для фильтрации результатов слов, содержащих git, объедините команды:

```powershell
wsl ls -la | findstr "git"
```

Чтобы выполнить команду PowerShell `dir` для вывода списка файлов и команду Linux `grep` для фильтрации результатов слов, содержащих git, объедините команды:

```powershell
C:\temp> dir | wsl grep git
```

Чтобы использовать команду Linux `ls -la` для вывода списка файлов и команду PowerShell `> out.txt` для вывода этого списка в текстовый файл с именем out.txt, объедините команды:

```powershell
C:\temp> wsl ls -la > out.txt
```

Команды, передаваемые в `wsl.exe`, перенаправляются в процесс WSL без изменения.  Пути к файлам должны быть указаны в формате WSL.

Чтобы выполнить команду Linux `ls -la` для вывода списка файлов в пути файловой системы Linux `/proc/cpuinfo` с помощью PowerShell, сделайте следующее:

```powershell
C:\temp> wsl ls -la /proc/cpuinfo
```

Чтобы выполнить команду Linux `ls -la` для вывода списка файлов в пути файловой системы Windows `C:\Program Files` с помощью PowerShell, сделайте следующее:

```powershell
C:\temp> wsl ls -la "/mnt/c/Program Files"
```

## <a name="run-windows-tools-from-linux"></a>Запуск инструментов Windows из Linux

WSL может запускать средства Windows непосредственно из командной строки WSL с помощью `[tool-name].exe`.  Например, `notepad.exe`.

<!-- Craig - could you help add a section with an example here to explain this scenario: "To access your Linux files using a Windows tool, use `\\wsl$\<distroName>\'` as the file path." Currently it I can just enter `notepad.exe foo.txt` and it seems to work fine, so explaining a situation where the file path is needed would be helpful. -->

Приложения, выполняемые таким образом, обладают следующими свойствами.

* Рабочим каталогом остается каталог командной строки WSL (в большинстве случаев; исключения описаны ниже).
* Они имеют те же разрешения, что и процесс WSL.
* Они выполняются от имени активного пользователя Windows.
* Они отображаются в диспетчере задач Windows так, как если бы они выполнялись непосредственно из командной строки.

Исполняемые файлы Windows, выполняемые в WSL, обрабатываются аналогично собственным исполняемым файлам Linux — конвейерной передаче, перенаправлению и даже фоновому режиму работы.

Чтобы запустить средство Windows `ipconfig.exe`, использовать средство Linux `grep` для фильтрации результатов IPv4, а также средство Linux `cut` для удаления полей столбцов из дистрибутива Linux (например, Ubuntu), введите:

```bash
ipconfig.exe | grep IPv4 | cut -d: -f2
```

Давайте рассмотрим пример сочетания команд Windows и Linux. Откройте дистрибутив Linux (например, Ubuntu) и создайте текстовый файл: `touch foo.txt`. Теперь используйте команду Linux `ls -la`, чтобы отобразить список файлов прямого доступа и сведения об их создании, а также средство Windows PowerShell `findstr.exe`, чтобы отфильтровать результаты и отобразить только файл `foo.txt`:

```bash
ls -la | findstr.exe foo.txt
```

Средства Windows должны иметь расширение файла, его регистр символов должен совпадать с регистром в имени файла и эти файлы должны быть исполняемыми.  Неисполняемые файлы, в том числе сценарии пакетного выполнения и  собственные команды командной строки, такие как `dir`, можно выполнять с помощью команды `cmd.exe /C`.

Например, отобразите список содержимого каталога C:\ файловой системы Windows, введя:

```bash
cmd.exe /C dir
```

Или выполните команду `ping`, чтобы отправить запрос проверки связи на веб-сайт microsoft.com:

```bash
ping.exe www.microsoft.com
```

Параметры передаются в двоичный файл Windows без изменений. Например, следующая команда откроет `C:\temp\foo.txt` в `notepad.exe`.

```bash
notepad.exe "C:\temp\foo.txt"
```

Этот способ также будет работать:

```bash
notepad.exe C:\\temp\\foo.txt
```

## <a name="share-environment-variables-between-windows-and-wsl"></a>Совместное использование переменных среды между Windows и WSL

Решение WSL и Windows совместно используют `WSLENV` — специальную переменную среды, созданную для взаимодействия Windows и дистрибутивов Linux, запущенных в WSL.

Свойства переменной `WSLENV`:

* она используется совместно и существует в средах Windows и WSL;
* это список переменных среды, которые совместно используют Windows и WSL;
* она позволяет форматировать список переменных среды для корректного использования в Windows и WSL.
* она может использоваться в потоке между WSL и Win32.

> [!NOTE]
> До выпуска сборки 17063 единственной переменной среды Windows,, к которой могла получить доступ WSL, была `PATH` (это позволяло запускать исполняемые файлы Win32 из WSL). Начиная со сборки 17063, `WSLENV` поддерживается.

## <a name="wslenv-flags"></a>Флаги WSLENV

В `WSLENV` доступны четыре флага, влияющие на способ преобразования переменной среды.

Флаги `WSLENV`:

* `/p` преобразовывает пути WSL и Linux в пути Win32 и наоборот;
* `/l` указывает, что переменная среды представляет собой список путей;
* `/u` указывает, что эту переменную среды следует добавлять только при запуске WSL из Win32;
* `/w` указывает, что эту переменную среды следует добавлять только при запуске Win32 из WSL.

При необходимости флаги можно комбинировать.

[Узнайте больше о WSLENV](https://devblogs.microsoft.com/commandline/share-environment-vars-between-wsl-and-windows/), ознакомившись с часто задаваемыми вопросами и примерами установки значения WSLENV для объединения других предварительно определенных переменных среды с суффиксом в виде косой чертой и флагами для указания способа перевода значения и передачи переменных скрипту. В этой статье также показано, как настроить среду разработки с помощью [языка программирования Go](https://golang.org/) для совместного использования GOPATH с WSL и Win32.

## <a name="disable-interoperability"></a>Отключение взаимодействия

Пользователи могут отключить возможность запуска средств Windows для отдельного сеанса WSL, выполнив следующую команду в качестве привилегированного пользователя.

```bash
echo 0 > /proc/sys/fs/binfmt_misc/WSLInterop
```

Чтобы повторно включить возможность запуска двоичных файлов Windows, закройте все сеансы WSL и повторно запустите bash.exe или выполните следующую команду от имени привилегированного пользователя.

```bash
echo 1 > /proc/sys/fs/binfmt_misc/WSLInterop
```

Отключение взаимодействия не будет сохраняться между сеансами WSL, оно снова будет включено при запуске нового сеанса.

## <a name="earlier-versions-of-windows-10"></a>Предшествующие версии Windows 10

В предшествующих версиях Windows 10 для команд взаимодействия существует несколько различий. Если вы используете версию Creators Update (октябрь 2017 г., сборка 16299) или Юбилейного обновления (август 2016 г., сборка 14393) Windows 10, мы рекомендуем [выполнить обновление до последней версии Windows](ms-settings:windowsupdate). Если это невозможно, мы выделили некоторые отличия при взаимодействии ниже.

Сводка:

* `bash.exe` заменен на `wsl.exe`;
* параметр `-c` не требуется для выполнения одной команды `wsl.exe`;
* путь Windows включен в переменную `$PATH` WSL.
* Процесс отключения взаимодействия не изменяется.

Команды Linux можно запускать из командной строки Windows или из PowerShell, но для ранних версий Windows необходимо использовать команду `bash`. Например:

```powershell
C:\temp> bash -c "ls -la"
```

Такие функции, как ввод, конвейерная передача и перенаправление файлов, работают должным образом.

Команды WSL, передаваемые в `bash -c`, перенаправляются в процесс WSL без изменения.  Пути к файлам должны быть указаны в формате WSL, кроме того, необходимо внимательно экранировать соответствующие знаки. Пример:

```console
C:\temp> bash -c "ls -la /proc/cpuinfo"
```

–или–

```powershell
C:\temp> bash -c "ls -la \"/mnt/c/Program Files\""
```

При вызове средства Windows из дистрибутива WSL в ранних версиях Windows 10 необходимо указать путь к каталогу. Например, в командной строке WSL введите:

```bash
/mnt/c/Windows/System32/notepad.exe
```

В WSL эти исполняемые файлы обрабатываются аналогично собственным исполняемым файлам Linux.  Это означает, что добавление каталогов в путь Linux и их конвейерная передача между командами выполняется должным образом.  Например:

```bash
export PATH=$PATH:/mnt/c/Windows/System32
```
Или

```bash
ipconfig.exe | grep IPv4 | cut -d: -f2
```

Двоичный файл Windows должен иметь расширение файла, его регистр символов должен совпадать с регистром в имени файла и этот файл должен быть исполняемым.  Неисполняемые файлы, включая сценарии пакетной службы и команды, такие как `dir`, могут выполняться с помощью команды `/mnt/c/Windows/System32/cmd.exe /C`. Например:

```bash
/mnt/c/Windows/System32/cmd.exe /C dir
```

## <a name="additional-resources"></a>Дополнительные ресурсы

* [Запись блога WSL о взаимодействии за 2016 год](https://blogs.msdn.microsoft.com/wsl/2016/10/19/windows-and-ubuntu-interoperability/)
