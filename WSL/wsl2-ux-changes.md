---
title: Изменения взаимодействия с пользователем в WSL 1 и WSL 2
description: Изменения взаимодействия с пользователем в WSL 1 и WSL 2
keywords: BashOnWindows, bash, wsl, wsl2, windows, подсистема Windows для Linux, windowssubsystem, ubuntu, debian, suse, windows 10
ms.date: 05/30/2019
ms.topic: article
ms.assetid: 7afaeacf-435a-4e58-bff0-a9f0d75b8a51
ms.custom: seodec18
ms.localizationpriority: high
ms.openlocfilehash: 1965a22a2e290777b207d9ded099ce4a79e1ed38
ms.sourcegitcommit: 39d3a2f0f4184eaec8d8fec740aff800e8ea9ac7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/24/2020
ms.locfileid: "80256337"
---
# <a name="user-experience-changes-between-wsl-1-and-wsl-2"></a>Изменения взаимодействия с пользователем в WSL 1 и WSL 2

На этой странице рассматриваются различия во взаимодействии с пользователем в WSL 1 и WSL 2 (ознакомительная версия). Основные изменения, которые следует учитывать:

- Размещайте файлы, к которым приложения Linux будут обращаться, в корневой файловой системе Linux, чтобы ускорить их производительность.
- В начальных сборках WSL 2 (ознакомительная версия) необходимо получить доступ к сетевым приложениям с помощью IP-адреса, а не localhost.

Ниже приведен полный список других изменений, с которыми вы можете ознакомиться:

- WSL 2 использует [виртуальный жесткий диск](https://en.wikipedia.org/wiki/VHD_(file_format)) (VHD) для хранения файлов, а при достижении максимального размера, возможно, потребуется его расширить.
- При запуске WSL 2 теперь используется малая часть памяти.
- Скорость доступа к файлам между операционными системами будет ниже в первоначальных сборках (ознакомительная версия).

## <a name="place-your-linux-files-in-your-linux-root-file-system"></a>Размещение файлов Linux в корневой файловой системе Linux
Обязательно помещайте файлы, к которым часто будут обращаться приложения Linux, в корневую файловую систему Linux, чтобы получить преимущества производительности файлов. Для ускорения доступа к файловой системе эти файлы должны находиться в корневой файловой системе Linux. Мы также сделали так, чтобы приложения Windows могли получить доступ к корневой файловой системе Linux (как в проводнике; попробуйте выполнить `explorer.exe .` в домашнем каталоге дистрибутива Linux и посмотрите, что произойдет), что сделает этот переход значительно проще. 

## <a name="accessing-network-applications"></a>Доступ к сетевым приложениям
В начальных сборках WSL 2 (ознакомительная версия) необходимо получить доступ к любому серверу Windows из Linux, используя IP-адрес хост-компьютера.

### <a name="accessing-windows-applications-from-linux"></a>Доступ к приложениям Windows из Linux
Для доступа к сетевому приложению Windows необходимо использовать IP-адрес хост-компьютера. Чтобы это сделать, выполните следующие действия:

- Получите IP-адрес хост-компьютера, выполнив команду `cat /etc/resolv.conf` и скопировав IP-адрес после термина `nameserver`. 
- Подключитесь к любому серверу Windows, используя скопированный IP-адрес.

На изображении ниже показан пример подключения к серверу Node.js под управлением Windows через cURL. 

![Доступ к сетевым приложениям Linux из Windows](media/wsl2-network-l2w.png)

### <a name="accessing-linux-applications-from-windows"></a>Доступ к приложениям Linux из Windows

В зависимости от используемой версии Windows может потребоваться получить IP-адрес виртуальной машины. Если у вас сборка версии 18945 или выше, `localhost` можно использовать как обычно. 

#### <a name="accessing-linux-on-builds-lower-than-18945"></a>Доступ к Linux в сборках ниже [18945](https://blogs.windows.com/windowsexperience/2019/07/26/announcing-windows-10-insider-preview-build-18945/)

Если у вас есть сервер в дистрибутиве WSL, вам потребуется найти IP-адрес виртуальной машины, на котором работает дистрибутив, и подключиться к нему по этому IP-адресу. Для этого выполните следующие действия:

- Получите IP-адрес дистрибутива, выполнив команду `ip addr` внутри дистрибутива WSL. Он будет находиться в значении `inet` интерфейса `eth0`.
   - Это проще всего сделать, фильтруя выходные данные команды с помощью grep следующим образом: `ip addr | grep eth0`.
- Подключитесь к серверу Linux с помощью указанного выше IP-адреса.

На изображении ниже показан пример подключения к серверу Node.js с помощью браузера Edge.

![Доступ к сетевым приложениям Linux из Windows](media/wsl2-network-w2l.jpg)

### <a name="other-networking-considerations"></a>Другие рекомендации по сети

#### <a name="connecting-via-remote-ip-addresses"></a>Подключение через удаленные IP-адреса

При использовании удаленных IP-адресов для подключения к приложениям они будут рассматриваться как подключения из локальной сети (LAN). Это означает, что необходимо убедиться, что приложение может принимать подключения по локальной сети, т. е. вам может потребоваться привязать приложение к `0.0.0.0` вместо `127.0.0.1`. Например, в Python с использованием Flask это можно сделать с помощью команды: `app.run(host='0.0.0.0')`. При внесении этих изменений не забывайте о безопасности, так как это позволит устанавливать подключения из вашей локальной сети. 

#### <a name="accessing-a-wsl2-distro-from-your-local-area-network-lan"></a>Доступ к дистрибутиву WSL2 из локальной сети (LAN)

При использовании дистрибутива WSL1, если к компьютеру можно получить доступ из локальной сети, то приложения, работающие в WSL, могут быть также доступны в локальной сети. Этот вариант не используется по умолчанию в WSL2, так как WSL2 содержит виртуализованный адаптер Ethernet с собственным IP-адресом. В настоящее время для включения этого рабочего процесса необходимо выполнить те же действия, что и для обычной виртуальной машины. Мы ищем способы улучшить это взаимодействие!

#### <a name="ipv6-access"></a>Доступ по протоколу IPv6

В настоящее время дистрибутивы WSL2 не могут связаться только с IPv6-адресами. Мы работаем над добавлением этой возможности.

## <a name="understanding-wsl-2-uses-a-vhd-and-what-to-do-if-you-reach-its-max-size"></a>Порядок действий при достижении максимального размера VHD, который используется WSL 2
WSL 2 сохраняет все файлы Linux в VHD, использующем файловую систему ext4. Размер этого виртуального жесткого диска автоматически изменяется в соответствии с потребностями хранилища. Этот VHD также имеет исходный максимальный размер 256 ГБ. Если размер дистрибутива превысил 256 ГБ, вы увидите сообщение об ошибке, что закончилось место на диске. Это можно исправить, расширив размер VHD. Ниже приведены инструкции о том, как это сделать:

1. Завершите работы всех экземпляров WSL с помощью команды `wsl --shutdown`.
2. Найдите пакет установки дистрибутива PackageFamilyName.
   - В командной строке PowerShell (где distro — имя распространения) введите:
      - `Get-AppxPackage -Name "*<distro>*" | Select PackageFamilyName`
3. Укажите полный путь к файлу VHD, используемый для установки WSL 2 (pathToVHD):
     - `%LOCALAPPDATA%\Packages\<PackageFamilyName>\LocalState\<disk>.vhdx`
4. Измените размер VHD WSL 2, выполнив следующие команды.
   - Откройте окно командной строки с правами администратора и выполните следующие команды:
      - `diskpart`
      - `Select vdisk file="<pathToVHD>"`
      - `expand vdisk maximum="<sizeInMegaBytes>"`
5. Запустите дистрибутив WSL.
6. Учитывайте, что WSL может расширить свой размер файловой системы.
   - Выполните следующие команды в дистрибутиве WSL:
      - `sudo mount -t devtmpfs none /dev`
      - `mount | grep ext4`
         - Скопируйте имя этой записи, которая будет выглядеть следующим образом: /dev/sdXX (вместо X может быть любой другой символ).
      - `sudo resize2fs /dev/sdXX`
         - Используйте скопированное ранее значение. Возможно, потребуется использовать: `apt install resize2fs`.

Примечание. Как правило, не следует изменять, перемещать файлы, связанные с WSL, расположенным внутри папки AppData, или получать к ним доступ с помощью инструментов или редакторов Windows. Это может привести к повреждению дистрибутива Linux.

## <a name="wsl-2-will-use-some-memory-on-startup"></a>Использование небольшого объема памяти при запуске WSL 2
WSL 2 использует упрощенную служебную виртуальную машину на реальном ядре Linux, чтобы обеспечить высокую производительность файловой системы и полную совместимость системных вызовов, оставаясь при этом таким же легким, быстрым, интегрированным и с хорошей скоростью отклика как и WSL 1. Эта служебная виртуальная машина имеет небольшой объем памяти и выделяет память, поддерживаемую в виртуальном адресе, при запуске. Она настроена на запуск с использованием малой части от общего объема памяти.

## <a name="cross-os-file-speed-will-be-slower-in-initial-preview-builds"></a>Скорость доступа к файлам между операционными системами будет ниже в первоначальных сборках ознакомительной версии
По сравнению с WSL 1 при доступе к файлам Windows из приложения Linux или доступе к файлам Linux из приложения Windows скорость будет ниже. Это результат изменений архитектуры в WSL 2, и группа WSL активно изучает, как можно улучшить это взаимодействие.
