---
title: Разрешения для файла
description: Общие сведения о том, как WSL определяет разрешения для файлов в Windows
keywords: Башонвиндовс, bash, WSL, wsl2, Windows, подсистема Windows для Linux, виндовссубсистем, Ubuntu, Debian, SUSE, Windows 10, файл, разрешения
ms.date: 01/14/2020
ms.topic: article
ms.assetid: 7afaeacf-435a-4e58-bff0-a9f0d75b8a51
ms.custom: seodec18
ms.openlocfilehash: 4566fc86cf14df986bde80cf3a6cfb9267b23308
ms.sourcegitcommit: 07eb5f2e1f4517928165dda4510012599b0d0e1e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/22/2020
ms.locfileid: "76520863"
---
# <a name="file-permissions-for-wsl"></a>Разрешения файла для WSL

На этой странице подробно описана интерпретация разрешений файлов Linux в подсистеме Windows для Linux, особенно при доступе к ресурсам в Windows в файловой системе NT. В этой документации предполагается, что основные сведения о [структуре разрешений файловой системы Linux](https://wiki.archlinux.org/index.php/File_permissions_and_attributes) <!--TODO: Double check that it's okay to add these links--> и [команда umask](https://en.wikipedia.org/wiki/Umask).

При доступе к файлам Windows из WSL разрешения на файлы либо рассчитываются из разрешений Windows, либо считываются из метаданных, которые были добавлены в файл WSL. По умолчанию эти метаданные не включены. 

## <a name="wsl-metadata-on-windows-files"></a>Метаданные WSL в файлах Windows

Если метаданные включены в качестве параметра подключения в WSL, можно добавить и интерпретировать расширенные атрибуты в файлах Windows NT, чтобы предоставить разрешения файловой системы Linux. 

WSL может добавлять четыре расширенных атрибута NTFS:

| Имя атрибута | Описание |
| --- | --- |
| $LXUID | Идентификатор владельца пользователя |
| $LXGID | Идентификатор владельца группы |
| $LXMOD | Файловый режим (восьмеричные разрешения и тип разрешений файловой системы, например: 0777) |
| $LXDEV | Устройство, если это файл устройства |

Кроме того, любой файл, который не является обычным файлом или каталогом (например, символических ссылок, ФИФО, блочные устройства, сокеты Unix и символьные устройства), также имеет [точку повторного анализа](https://docs.microsoft.com/en-us/windows/win32/fileio/reparse-points)NTFS. Это значительно ускоряет определение типа файла в определенном каталоге без запроса его расширенных атрибутов. 
<!-- TODO: For the blog include ONeDrive detail -->

## <a name="file-access-scenarios"></a>Сценарии доступа к файлам

Ниже приведено описание того, как определяются разрешения при доступе к файлам различными способами с помощью подсистемы Windows для Linux.

### <a name="accessing-files-in-the-windows-drive-file-system-drvfs-from-linux"></a>Доступ к файлам в файловой системе Windows Drive (Дрвфс) из Linux

Эти сценарии возникают при доступе к файлам Windows из WSL, скорее всего, с помощью `/mnt/c`. 

#### <a name="reading-file-permissions-from-an-existing-windows-file"></a>Чтение разрешений файла из существующего файла Windows

Результат зависит от того, есть ли у файла уже существующие метаданные.

##### <a name="the-file-does-not-have-metadata-default"></a>**Файл не имеет метаданных (по умолчанию)**

Если с файлом не связаны метаданные, мы преобразуем действующие разрешения пользователя Windows на чтение, запись и выполнение BITS и присвоить этому файлу такое же значение для пользователя, группы и других. Например, если учетная запись пользователя Windows имеет доступ на чтение и выполнение, но не имеет доступа на запись к файлу, то он будет отображаться как `r-x` для пользователя, группы и других. Если для файла в Windows установлен атрибут "только для чтения", доступ на запись в Linux не предоставляется.

##### <a name="the-file-has-metadata"></a>Файл содержит метаданные

Если в файле есть метаданные, мы просто используем эти значения метаданных вместо перевода действующих разрешений пользователя Windows.

#### <a name="changing-file-permissions-on-an-existing-windows-file-using-chmod"></a>Изменение разрешений для файла в существующем файле Windows с помощью команды chmod

Результат зависит от того, есть ли у файла уже существующие метаданные.

##### <a name="the-file-does-not-have-metadata-default"></a>**Файл не имеет метаданных (по умолчанию)**

Chmod будет иметь только один результат. Если удалить все атрибуты записи файла, то будет установлен атрибут "только для чтения" в файле Windows, так как это то же поведение, что и CIFS (Общая файловая система Интернета), которая является клиентом SMB (серверный блок сообщений) в Linux.

##### <a name="the-file-has-metadata"></a>Файл содержит метаданные

Параметр chmod изменит или добавит метаданные в зависимости от уже существующих метаданных файла. 

Имейте в виду, что вы не можете предоставить вам больше доступа, чем у вас в Windows, даже если в метаданных указано, что это так. Например, можно задать для метаданных отображение разрешений на запись в файл с помощью `chmod 777`, но если вы попытались получить доступ к этому файлу, запись в него будет невозможна. Это спасибо за взаимодействие, так как любые команды чтения или записи для файлов Windows направляются через разрешения пользователя Windows.

#### <a name="creating-a-file-in-drivefs"></a>Создание файла в Дривефс

Результат зависит от того, включены ли метаданные.

##### <a name="metadata-is-not-enabled-default"></a>Метаданные не включены (по умолчанию)

Разрешения Windows для вновь созданного файла будут такими же, как если бы вы создали файл в Windows без определенного дескриптора безопасности, он наследует разрешения родителя. 

##### <a name="metadata-is-enabled"></a>Метаданные включены

Биты разрешений файла задаются в соответствии с umask Linux, и файл будет сохранен вместе с метаданными.

#### <a name="which-linux-user-and-linux-group-owns-the-file"></a>Какой пользователь Linux и группа Linux владеет файлом? 

Результат зависит от того, есть ли у файла уже существующие метаданные.

##### <a name="the-file-does-not-have-metadata-default"></a>**Файл не имеет метаданных (по умолчанию)**
В сценарии по умолчанию при автомонтировании дисков Windows мы указываем, что ИДЕНТИФИКАТОРу пользователя (UID) для любого файла присваивается идентификатор пользователя WSL, а ИДЕНТИФИКАТОРу группы (GID) присваивается идентификатор группы участников пользователя WSL. 

##### <a name="the-file-has-metadata"></a>Файл содержит метаданные

Идентификаторы UID и GID, указанные в метаданных, применяются как владелец пользователя и владелец группы файла. 

### <a name="accessing-linux-files-from-windows-using-wsl"></a>Доступ к файлам Linux из Windows с помощью `\\wsl$`

Для доступа к файлам Linux с помощью `\\wsl$` будет использоваться пользователь по умолчанию WSL дистрибутив. Таким образом, все приложения Windows, обращающиеся к файлам Linux, будут иметь те же разрешения, что и пользователь по умолчанию.

#### <a name="creating-a-new-file"></a>Создание нового файла

Umask по умолчанию применяется при создании нового файла в WSL дистрибутив из Windows. Значение по умолчанию umask `022`или другими словами, оно позволяет использовать все разрешения, кроме разрешения на запись в группы и другие. 

### <a name="accessing-files-in-the-linux-root-file-system-from-linux"></a>Доступ к файлам в корневой файловой системе Linux из Linux

Все файлы, созданные, измененные или доступные в корневой файловой системе Linux, следуют стандартным соглашениям Linux, таким как применение umask к только что созданному файлу.

## <a name="configuring-file-permissions"></a>Настройка разрешений для файла

Вы можете настроить разрешения для файлов в дисках Windows с помощью параметров подключения в WSL. conf. Параметры подключения позволяют задать маски разрешений `umask`, `dmask` и `fmask`. `umask` применяется ко всем файлам, `dmask` применяется только к каталогам, а `fmask` применяется только к файлам. Эти маски разрешений затем помещаются в логическую операцию или при применении к файлам, например, если имеется `umask` значение `023` и `fmask` значение `022` то результирующая Маска разрешений для файлов будет `023`. 

Инструкции о том, как это сделать, см. на странице документа ["Управление дистрибутивами Linux"](./wsl-config.md) .
<!-- TODO: Add # to the link-->

